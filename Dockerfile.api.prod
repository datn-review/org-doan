FROM node:18.16.0-alpine as builder
WORKDIR /app

COPY . .
RUN npm i -g pnpm@8.7.4
RUN pnpm i

ENV NODE_ENV=production
RUN npx nx run api:build:prod

EXPOSE 2222

CMD [ "pnpm", "run", "start-api"]